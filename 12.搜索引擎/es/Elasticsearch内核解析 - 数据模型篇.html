<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Elasticsearch内核解析 - 数据模型篇 | 一颗牙疼</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="一颗牙疼的blog">
    
    <link rel="preload" href="/blog/assets/css/0.styles.b6bfb1ac.css" as="style"><link rel="preload" href="/blog/assets/js/app.c254b5bd.js" as="script"><link rel="preload" href="/blog/assets/js/2.990d1a98.js" as="script"><link rel="preload" href="/blog/assets/js/44.0c2abd5a.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.cd53ceb6.js"><link rel="prefetch" href="/blog/assets/js/11.43e20106.js"><link rel="prefetch" href="/blog/assets/js/12.bd29fa38.js"><link rel="prefetch" href="/blog/assets/js/13.0e80f7c6.js"><link rel="prefetch" href="/blog/assets/js/14.8e6db11d.js"><link rel="prefetch" href="/blog/assets/js/15.2023b1a0.js"><link rel="prefetch" href="/blog/assets/js/16.6eef376f.js"><link rel="prefetch" href="/blog/assets/js/17.e148b682.js"><link rel="prefetch" href="/blog/assets/js/18.6a4e3c32.js"><link rel="prefetch" href="/blog/assets/js/19.a9cb1e12.js"><link rel="prefetch" href="/blog/assets/js/20.dde1362e.js"><link rel="prefetch" href="/blog/assets/js/21.94bccb49.js"><link rel="prefetch" href="/blog/assets/js/22.5bd2630e.js"><link rel="prefetch" href="/blog/assets/js/23.d9d3cf71.js"><link rel="prefetch" href="/blog/assets/js/24.25cf4d9d.js"><link rel="prefetch" href="/blog/assets/js/25.18ffb876.js"><link rel="prefetch" href="/blog/assets/js/26.86237f33.js"><link rel="prefetch" href="/blog/assets/js/27.c27651a8.js"><link rel="prefetch" href="/blog/assets/js/28.31656f77.js"><link rel="prefetch" href="/blog/assets/js/29.d318114c.js"><link rel="prefetch" href="/blog/assets/js/3.d5a63fc1.js"><link rel="prefetch" href="/blog/assets/js/30.89643bc6.js"><link rel="prefetch" href="/blog/assets/js/31.179c3084.js"><link rel="prefetch" href="/blog/assets/js/32.42802d10.js"><link rel="prefetch" href="/blog/assets/js/33.76baa52a.js"><link rel="prefetch" href="/blog/assets/js/34.5b630f80.js"><link rel="prefetch" href="/blog/assets/js/35.dac69750.js"><link rel="prefetch" href="/blog/assets/js/36.90259f78.js"><link rel="prefetch" href="/blog/assets/js/37.758c9508.js"><link rel="prefetch" href="/blog/assets/js/38.d8aafc84.js"><link rel="prefetch" href="/blog/assets/js/39.3f2b6283.js"><link rel="prefetch" href="/blog/assets/js/4.2cf3bfb8.js"><link rel="prefetch" href="/blog/assets/js/40.194592c7.js"><link rel="prefetch" href="/blog/assets/js/41.3949b107.js"><link rel="prefetch" href="/blog/assets/js/42.8f5bb95e.js"><link rel="prefetch" href="/blog/assets/js/43.f199ffc2.js"><link rel="prefetch" href="/blog/assets/js/45.b21ced36.js"><link rel="prefetch" href="/blog/assets/js/46.0e4c9f45.js"><link rel="prefetch" href="/blog/assets/js/47.1acf1375.js"><link rel="prefetch" href="/blog/assets/js/48.f4ed0c8a.js"><link rel="prefetch" href="/blog/assets/js/49.7fcdf53f.js"><link rel="prefetch" href="/blog/assets/js/5.87a2e6b3.js"><link rel="prefetch" href="/blog/assets/js/50.63b4ba49.js"><link rel="prefetch" href="/blog/assets/js/51.ef228d75.js"><link rel="prefetch" href="/blog/assets/js/52.4ae6ce53.js"><link rel="prefetch" href="/blog/assets/js/53.547cc4e9.js"><link rel="prefetch" href="/blog/assets/js/54.597bfd38.js"><link rel="prefetch" href="/blog/assets/js/6.7c8e729f.js"><link rel="prefetch" href="/blog/assets/js/7.562bd62e.js"><link rel="prefetch" href="/blog/assets/js/8.d8781dd7.js"><link rel="prefetch" href="/blog/assets/js/9.309563fb.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.b6bfb1ac.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">一颗牙疼</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="http://www.macrozheng.com/#/README" target="_blank" rel="noopener noreferrer" class="nav-link external">
  mall
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/Atoothache/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/" class="nav-link">
  Chinese
</a></li><li class="dropdown-item"><!----> <a href="/blog/" class="nav-link">
  Japanese
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="http://www.macrozheng.com/#/README" target="_blank" rel="noopener noreferrer" class="nav-link external">
  mall
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/Atoothache/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/" class="nav-link">
  Chinese
</a></li><li class="dropdown-item"><!----> <a href="/blog/" class="nav-link">
  Japanese
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Spring</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据库</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>框架</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>服务器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>脚本语言</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>模板引擎</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>安全认证</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>设计模式</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>搜索引擎</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>Es</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/12.搜索引擎/es/Elasticsearch 入门 _bulk 批量导入数据.html" class="sidebar-link">Elasticsearch 入门: _bulk 批量导入数据</a></li><li><a href="/blog/12.搜索引擎/es/Elasticsearch内核解析 - 数据模型篇.html" class="active sidebar-link">Elasticsearch内核解析 - 数据模型篇</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/12.搜索引擎/es/Elasticsearch内核解析 - 数据模型篇.html#lucene数据模型" class="sidebar-link">Lucene数据模型</a></li><li class="sidebar-sub-header"><a href="/blog/12.搜索引擎/es/Elasticsearch内核解析 - 数据模型篇.html#lucene的不足" class="sidebar-link">Lucene的不足</a></li></ul></li><li><a href="/blog/12.搜索引擎/es/Lucene 的存储结构概述.html" class="sidebar-link">Lucene 的存储结构概述</a></li><li><a href="/blog/12.搜索引擎/es/es 更新延迟问题.html" class="sidebar-link">es 更新延迟问题</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Solr</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工具</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="elasticsearch内核解析-数据模型篇"><a href="#elasticsearch内核解析-数据模型篇" class="header-anchor">#</a> Elasticsearch内核解析 - 数据模型篇</h1> <p>Elasticsearch是一个实时的分布式搜索和分析引擎，它可以帮助我们用很快的速度去处理大规模数据，可以用于全文检索、结构化检索、推荐、分析以及统计聚合等多种场景。</p> <p>Elasticsearch是一个建立在全文搜索引擎库Apache Lucene 基础上的分布式搜索引擎，Lucene最早的版本是2000年发布的，距今已经18年，是当今最先进，最高效的全功能开源搜索引擎框架，众多搜索领域的系统都基于Lucene开发，比如Nutch，Solr和Elasticsearch等。Elasticsearch第一个版本发布于2010年，发布后就以非常快的速度霸占了开源搜索系统领域，成为目前搜索领域的首选，著名的维基百科，GitHub和Stack Overflow都在使用它。</p> <p>既然有Lucene娥，为啥还会出现很火的Elasticsearch？回答这个问题之前， 我们先来简单看一下Lucene中的一些数据模型：</p> <h2 id="lucene数据模型"><a href="#lucene数据模型" class="header-anchor">#</a> Lucene数据模型</h2> <p>Lucene中包含了四种基本数据类型，分别是：</p> <ul><li>Index：索引，由很多的Document组成。</li> <li>Document：由很多的Field组成，是Index和Search的最小单位。</li> <li>Field：由很多的Term组成，包括Field Name和Field Value。</li> <li>Term：由很多的字节组成，可以分词。</li></ul> <p>上述四种类型在Elasticsearch中同样存在，意思也一样。</p> <p>Lucene中存储的索引主要分为三种类型：</p> <ul><li>Invert Index：倒排索引，或者简称Index，通过Term可以查询到拥有该Term的文档。可以配置为是否分词，如果分词可以配置不同的分词器。索引存储的时候有多种存储类型，分别是：</li> <li>DOCS：只存储DocID。</li> <li>DOCS_AND_FREQS：存储DocID和词频（Term Freq）。</li> <li>DOCS_AND_FREQS_AND_POSITIONS：存储DocID、词频（Term Freq）和位置。</li> <li>DOCS_AND_FREQS_AND_POSITIONS_AND_OFFSETS：存储DocID、词频（Term Freq）、位置和偏移。</li> <li>DocValues：正排索引，采用列式存储。通过DocID可以快速读取到该Doc的特定字段的值。由于是列式存储，性能会比较好。一般用于sort，agg等需要高频读取Doc字段值的场景。</li> <li>Store：字段原始内容存储，同一篇文章的多个Field的Store会存储在一起，适用于一次读取少量且多个字段内存的场景，比如摘要等。</li></ul> <p>Lucene中提供索引和搜索的最小组织形式是Segment，Segment中按照索引类型不同，分成了Invert Index，Doc Values和Store这三大类（还有一些辅助类，这里省略），每一类里面都是按照Doc为最小单位存储。Invert Index中存储的Key是Term，Value是Doc ID的链表；Doc Value中Key 是Doc ID和Field Name，Value是Field Value；Store的Key是Doc ID，Value是Filed Name和Filed Value。</p> <p>由于Lucene中没有主键概念和更新逻辑，所有对Lucene的更新都是Append一个新Doc，类似于一个只能Append的队列，所有Doc都被同等对等，同样的处理方式。其中的Doc由众多Field组成，没有特殊Field，每个Field也都被同等对待，同样的处理方式。</p> <p>从上面介绍来看，Lucene只是提供了一个索引和查询的最基本的功能，距离一个完全可用的完整搜索引擎还有一些距离：</p> <h2 id="lucene的不足"><a href="#lucene的不足" class="header-anchor">#</a> Lucene的不足</h2> <ol><li>Lucene是一个单机的搜索库，如何能以分布式形式支持海量数据?</li> <li>Lucene中没有更新，每次都是Append一个新文档，如何做部分字段的更新？</li> <li>Lucene中没有主键索引，如何处理同一个Doc的多次写入？</li> <li>在稀疏列数据中，如何判断某些文档是否存在特定字段？</li> <li>Lucene中生成完整Segment后，该Segment就不能再被更改，此时该Segment才能被搜索，这种情况下，如何做实时搜索？</li></ol> <p>上述几个问题，对于搜索而言都是至关重要的功能诉求，我们接下来看看Elasticsearch中是如何来解这些问题的。</p> <p>参考：https://zhuanlan.zhihu.com/p/34852646</p> <p>大佬知乎：https://www.zhihu.com/people/8080/posts</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/12.搜索引擎/es/Elasticsearch 入门 _bulk 批量导入数据.html" class="prev">
        Elasticsearch 入门: _bulk 批量导入数据
      </a></span> <span class="next"><a href="/blog/12.搜索引擎/es/Lucene 的存储结构概述.html">
        Lucene 的存储结构概述
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.c254b5bd.js" defer></script><script src="/blog/assets/js/2.990d1a98.js" defer></script><script src="/blog/assets/js/44.0c2abd5a.js" defer></script>
  </body>
</html>
