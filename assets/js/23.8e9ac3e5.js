(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{388:function(t,s,a){"use strict";a.r(s);var n=a(40),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"spring-security-å…¥é—¨åŸç†åŠå®æˆ˜"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#spring-security-å…¥é—¨åŸç†åŠå®æˆ˜"}},[t._v("#")]),t._v(" Spring Security å…¥é—¨åŸç†åŠå®æˆ˜")]),t._v(" "),a("p",[t._v("https://www.cnblogs.com/demingblog/p/10874753.html")]),t._v(" "),a("h1",{attrs:{id:"ã€è¯¦è§£ã€‘spring-security-ä¹‹-securitycontext"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ã€è¯¦è§£ã€‘spring-security-ä¹‹-securitycontext"}},[t._v("#")]),t._v(" ã€è¯¦è§£ã€‘Spring Security ä¹‹ SecurityContext")]),t._v(" "),a("p",[t._v("https://www.cnblogs.com/longfurcat/p/10293819.html")]),t._v(" "),a("p",[t._v("æ•´ç†ä¸€ä¸‹SecurityContextçš„å­˜å‚¨æ–¹å¼ã€‚")]),t._v(" "),a("h2",{attrs:{id:"securitycontextæ¥å£"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#securitycontextæ¥å£"}},[t._v("#")]),t._v(" SecurityContextæ¥å£")]),t._v(" "),a("p",[t._v('é¡¾åæ€ä¹‰ï¼Œå®‰å…¨ä¸Šä¸‹æ–‡ã€‚å³å­˜å‚¨è®¤è¯æˆæƒçš„ç›¸å…³ä¿¡æ¯ï¼Œå®é™…ä¸Šå°±æ˜¯å­˜å‚¨"'),a("strong",[t._v("å½“å‰ç”¨æˆ·")]),t._v('"è´¦å·ä¿¡æ¯å’Œç›¸å…³æƒé™ã€‚è¿™ä¸ªæ¥å£åªæœ‰ä¸¤ä¸ªæ–¹æ³•ï¼ŒAuthenticationå¯¹è±¡çš„getterã€setterã€‚')]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("security"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("core"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("context")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("java"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("io"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Serializable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("security"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("core"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Authentication")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SecurityContext")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Serializable")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Authentication")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getAuthentication")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setAuthentication")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Authentication")]),t._v(" var1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"authenticationæ¥å£åˆæ˜¯å¹²å˜›çš„"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#authenticationæ¥å£åˆæ˜¯å¹²å˜›çš„"}},[t._v("#")]),t._v(" Authenticationæ¥å£åˆæ˜¯å¹²å˜›çš„ï¼Ÿ")]),t._v(" "),a("p",[t._v("æ³¨æ„ï¼šSecurityContextå­˜å‚¨çš„Authenticationå¯¹è±¡æ˜¯ç»è¿‡è®¤è¯çš„ï¼Œæ‰€ä»¥å®ƒä¼šå¸¦æœ‰æƒé™ï¼Œå®ƒçš„getAuthorities()æ–¹æ³•ä¼šè¿”å›ç›¸å…³æƒé™ã€‚")]),t._v(" "),a("p",[t._v("["),a("img",{attrs:{src:"https://common.cnblogs.com/images/copycode.gif",alt:"å¤åˆ¶ä»£ç "}}),t._v("](javascript:void(0)ğŸ˜‰")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("security"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("core")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("java"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("io"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Serializable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("java"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("security"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Principal")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("java"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("util"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Collection")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Authentication")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Principal")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Serializable")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Collection")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("GrantedAuthority")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getAuthorities")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getCredentials")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getDetails")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getPrincipal")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("isAuthenticated")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setAuthenticated")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" var1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IllegalArgumentException")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("["),a("img",{attrs:{src:"https://common.cnblogs.com/images/copycode.gif",alt:"å¤åˆ¶ä»£ç "}}),t._v("](javascript:void(0)ğŸ˜‰")]),t._v(" "),a("h2",{attrs:{id:"securitycontextholderå·¥å…·ç±»"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#securitycontextholderå·¥å…·ç±»"}},[t._v("#")]),t._v(" SecurityContextHolderå·¥å…·ç±»")]),t._v(" "),a("p",[t._v('å‰é¢è¯´çš„"'),a("strong",[t._v("å½“å‰ç”¨æˆ·")]),t._v('"å®é™…ä¸ŠæŒ‡çš„æ˜¯å½“å‰è¿™ä¸ªè¯·æ±‚æ‰€å¯¹åº”çš„ç”¨æˆ·ï¼Œé‚£ä¹ˆæ€ä¹ˆçŸ¥é“å½“å‰ç”¨æˆ·æ˜¯è°å‘¢ï¼Ÿç”±äºä¸€ä¸ªè¯·æ±‚ä»å¼€å§‹åˆ°ç»“æŸéƒ½ç”±ä¸€ä¸ªçº¿ç¨‹å¤„ç†ï¼Œè¿™ä¸ªçº¿ç¨‹ä¸­é€”ä¹Ÿä¸ä¼šå»å¤„ç†å…¶ä»–çš„è¯·æ±‚ã€‚æ‰€ä»¥åœ¨è¿™æ®µæ—¶é—´å†…ï¼Œç›¸å½“äºè¿™ä¸ªçº¿ç¨‹è·Ÿå½“å‰ç”¨æˆ·æ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚SecurityContextHolderå·¥å…·ç±»å°±æ˜¯æŠŠSecurityContextå­˜å‚¨åœ¨å½“å‰çº¿ç¨‹ä¸­ã€‚')]),t._v(" "),a("p",[t._v("SecurityContextHolderå¯ä»¥ç”¨æ¥è®¾ç½®å’Œè·å–SecurityContextã€‚å®ƒä¸»è¦æ˜¯ç»™æ¡†æ¶å†…éƒ¨ä½¿ç”¨çš„ï¼Œå¯ä»¥åˆ©ç”¨å®ƒè·å–å½“å‰ç”¨æˆ·çš„SecurityContextè¿›è¡Œè¯·æ±‚æ£€æŸ¥ï¼Œå’Œè®¿é—®æ§åˆ¶ç­‰ã€‚")]),t._v(" "),a("p",[t._v("åœ¨Webç¯å¢ƒä¸‹ï¼ŒSecurityContextHolderæ˜¯åˆ©ç”¨ThreadLocalæ¥å­˜å‚¨SecurityContextçš„ã€‚")]),t._v(" "),a("h2",{attrs:{id:"è¯·æ±‚ç»“æŸ-securitycontextå­˜å‚¨åœ¨å“ªé‡Œ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#è¯·æ±‚ç»“æŸ-securitycontextå­˜å‚¨åœ¨å“ªé‡Œ"}},[t._v("#")]),t._v(" "),a("strong",[t._v("è¯·æ±‚ç»“æŸï¼ŒSecurityContextå­˜å‚¨åœ¨å“ªé‡Œï¼Ÿ")])]),t._v(" "),a("p",[t._v("æˆ‘ä»¬çŸ¥é“Sevletä¸­çº¿ç¨‹æ˜¯è¢«æ± åŒ–å¤ç”¨çš„ï¼Œä¸€æ—¦å¤„ç†å®Œå½“å‰çš„è¯·æ±‚ï¼Œå®ƒå¯èƒ½é©¬ä¸Šå°±ä¼šè¢«åˆ†é…å»å¤„ç†å…¶ä»–çš„è¯·æ±‚ã€‚è€Œä¸”ä¹Ÿä¸èƒ½ä¿è¯ç”¨æˆ·ä¸‹æ¬¡çš„è¯·æ±‚ä¼šè¢«åˆ†é…åˆ°åŒä¸€ä¸ªçº¿ç¨‹ã€‚æ‰€ä»¥å­˜åœ¨çº¿ç¨‹é‡Œé¢ï¼Œè¯·æ±‚ä¸€æ—¦ç»“æŸï¼Œå°±æ²¡äº†ã€‚å¦‚æœæ²¡æœ‰ä¿å­˜ï¼Œä¸æ˜¯æ¯æ¬¡è¯·æ±‚éƒ½è¦é‡æ–°è®¤è¯ç™»å½•ï¼Ÿæƒ³æƒ³çœ‹ï¼Œå¦‚æœæ²¡æœ‰æƒé™æ¡†æ¶æˆ‘ä»¬æ˜¯æ€ä¹ˆå¤„ç†çš„ï¼Ÿ")]),t._v(" "),a("p",[t._v("æƒ³åˆ°äº†å§ï¼Œå¦‚æœä¸ç”¨æƒé™æ¡†æ¶ï¼Œæˆ‘ä»¬ä¸€èˆ¬æ˜¯æŠŠè®¤è¯ç»“æœå­˜åœ¨Sessionä¸­çš„ã€‚åŒç†ï¼Œå®ƒä¹ŸæŠŠè®¤è¯ç»“æœå­˜å‚¨åˆ°Sessionäº†ã€‚")]),t._v(" "),a("p",[t._v('å¯¹åº”çš„Keyæ˜¯ï¼š"'),a("strong",[t._v("SPRING_SECURITY_CONTEXT")]),t._v('"')]),t._v(" "),a("h2",{attrs:{id:"æµç¨‹è§†å›¾"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æµç¨‹è§†å›¾"}},[t._v("#")]),t._v(" æµç¨‹è§†å›¾")]),t._v(" "),a("p",[a("img",{attrs:{src:"E:%5Cgitbook%5CSpring%5Cpic%5CSecurityContext%E7%9A%84%E5%AD%98%E5%82%A8%E6%B5%81%E7%A8%8B.png",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"securitycontextpersistencefilteræ‹¦æˆªå™¨"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#securitycontextpersistencefilteræ‹¦æˆªå™¨"}},[t._v("#")]),t._v(" SecurityContextPersistenceFilteræ‹¦æˆªå™¨")]),t._v(" "),a("p",[t._v("SecurityContextPersistenceFilteræ˜¯Securityçš„æ‹¦æˆªå™¨ï¼Œè€Œä¸”æ˜¯æ‹¦æˆªé“¾ä¸­çš„ç¬¬ä¸€ä¸ªæ‹¦æˆªå™¨ï¼Œè¯·æ±‚æ¥ä¸´æ—¶å®ƒä¼šä»HttpSessionä¸­æŠŠSecurityContextå–å‡ºæ¥ï¼Œç„¶åæ”¾å…¥SecurityContextHolderã€‚åœ¨æ‰€æœ‰æ‹¦æˆªå™¨éƒ½å¤„ç†å®Œæˆåï¼Œå†æŠŠSecurityContextå­˜å…¥HttpSessionï¼Œå¹¶æ¸…é™¤SecurityContextHolderå†…çš„å¼•ç”¨ã€‚")]),t._v(" "),a("p",[t._v("æ³¨ï¼šå…¶ä¸­repoå¯¹è±¡æ˜¯HttpSessionSecurityContextRepository")]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("doFilter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ServletRequest")]),t._v(" req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ServletResponse")]),t._v(" res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FilterChain")]),t._v(" chain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IOException")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ServletException")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HttpServletRequest")]),t._v(" request "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HttpServletRequest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HttpServletResponse")]),t._v(" response "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HttpServletResponse")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getAttribute")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("FILTER_APPLIED"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ensure that filter is only applied once per request")]),t._v("\n            chain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("doFilter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" debug "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" logger"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDebugEnabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setAttribute")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("FILTER_APPLIED"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Boolean")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("TRUE"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("forceEagerSessionCreation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HttpSession")]),t._v(" session "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getSession")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("debug "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" session"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("isNew")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                logger"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("debug")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Eagerly created session: "')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" session"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HttpRequestResponseHolder")]),t._v(" holder "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HttpRequestResponseHolder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//åˆ©ç”¨HttpSecurityContextRepositoryä»HttpSesionä¸­è·å–SecurityContextå¯¹è±¡")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//å¦‚æœæ²¡æœ‰HttpSessionï¼Œå³æµè§ˆå™¨ç¬¬ä¸€æ¬¡è®¿é—®æœåŠ¡å™¨ï¼Œè¿˜æ²¡æœ‰äº§ç”Ÿä¼šè¯ã€‚")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//å®ƒä¼šåˆ›å»ºä¸€ä¸ªç©ºçš„SecurityContextå¯¹è±¡")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SecurityContext")]),t._v(" contextBeforeChainExecution "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" repo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("loadContext")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("holder"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//æŠŠSecurityContextæ”¾å…¥åˆ°SecurityContextHolderä¸­")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SecurityContextHolder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setContext")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("contextBeforeChainExecution"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//æ‰§è¡Œæ‹¦æˆªé“¾ï¼Œè¿™ä¸ªé“¾ä¼šé€å±‚å‘ä¸‹æ‰§è¡Œ")]),t._v("\n            chain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("doFilter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("holder"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getRequest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" holder"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getResponse")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("finally")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//å½“æ‹¦æˆªå™¨éƒ½æ‰§è¡Œå®Œçš„æ—¶å€™æŠŠå½“å‰çº¿ç¨‹å¯¹åº”çš„SecurityContextä»SecurityContextHolderä¸­å–å‡ºæ¥")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SecurityContext")]),t._v(" contextAfterChainExecution "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SecurityContextHolder")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getContext")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Crucial removal of SecurityContextHolder contents - do this before anything")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// else.")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SecurityContextHolder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("clearContext")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//åˆ©ç”¨HttpSecurityContextRepositoryæŠŠSecurityContextå†™å…¥HttpSession")]),t._v("\n            repo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("saveContext")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("contextAfterChainExecution"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" holder"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getRequest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                    holder"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getResponse")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("removeAttribute")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("FILTER_APPLIED"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("debug"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                logger"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("debug")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SecurityContextHolder now cleared, as request processing completed"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"tomcatå»ºç«‹ä¼šè¯çš„æµç¨‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#tomcatå»ºç«‹ä¼šè¯çš„æµç¨‹"}},[t._v("#")]),t._v(" Tomcatå»ºç«‹ä¼šè¯çš„æµç¨‹")]),t._v(" "),a("p",[t._v("æœ‰äººå¯èƒ½å¯¹Tomcatå»ºç«‹ä¼šè¯çš„æµç¨‹è¿˜ä¸ç†Ÿæ‚‰ï¼Œè¿™é‡Œç¨å¾®æ•´ç†ä¸€ä¸‹ã€‚æ˜¯è¿™æ ·çš„ï¼Œå½“å®¢æˆ·æµè§ˆå™¨æ‰“å¼€åç¬¬ä¸€æ¬¡è®¿é—®TomcatæœåŠ¡å™¨ï¼ŒTomcatä¼šåˆ›å»ºä¸€ä¸ªHttpSesionå¯¹è±¡ï¼Œå­˜å…¥ä¸€ä¸ªConcurrentHashMapï¼ŒKeyæ˜¯SessionIdï¼ŒValueå°±æ˜¯HttpSessionã€‚ç„¶åè¯·æ±‚å®Œæˆåï¼Œåœ¨è¿”å›çš„æŠ¥æ–‡ä¸­æ·»åŠ "),a("strong",[t._v("Set-Cookieï¼šJSESSIONID=xxx")]),t._v("ï¼Œç„¶åå®¢æˆ·ç«¯æµè§ˆå™¨ä¼šä¿å­˜è¿™ä¸ªCookieã€‚å½“æµè§ˆå™¨å†æ¬¡è®¿é—®è¿™ä¸ªæœåŠ¡å™¨çš„æ—¶å€™ï¼Œéƒ½ä¼šå¸¦ä¸Šè¿™ä¸ªCookieã€‚Tomcatæ¥æ”¶åˆ°è¿™ä¸ªè¯·æ±‚åï¼Œæ ¹æ®JSESSIONIDæŠŠå¯¹åº”çš„HttpSessionå¯¹è±¡å–å‡ºæ¥ï¼Œæ”¾å…¥HttpSerlvetRequestå¯¹è±¡é‡Œé¢ã€‚")]),t._v(" "),a("p",[a("strong",[t._v("é‡ç‚¹ï¼š")])]),t._v(" "),a("p",[t._v("1.HttpSessionä¼šä¸€ç›´å­˜åœ¨æœåŠ¡ç«¯ï¼Œå®é™…ä¸Šæ˜¯å­˜åœ¨è¿è¡Œå†…å­˜ä¸­ã€‚é™¤éSessionè¿‡æœŸ OR Tomcatå¥”æºƒ OR æœåŠ¡å™¨å¥”æºƒï¼Œå¦åˆ™ä¼šè¯ä¿¡æ¯ä¸ä¼šæ¶ˆå¤±ã€‚")]),t._v(" "),a("p",[t._v("2.å¦‚æ— ç‰¹æ®Šå¤„ç†ï¼ŒCookie JSESSIONIDä¼šåœ¨æµè§ˆå™¨å…³é—­çš„æ—¶å€™æ¸…é™¤ã€‚")]),t._v(" "),a("p",[t._v("3.Tomcatä¸­HttpSesionçš„é»˜è®¤è¿‡æœŸæ—¶é—´ä¸º30åˆ†é’Ÿã€‚")]),t._v(" "),a("p",[t._v("4.è¿™äº›å¤„ç†éƒ½åœ¨Securityçš„æ‹¦æˆªé“¾ä¹‹å‰å®Œæˆã€‚")]),t._v(" "),a("p",[t._v("â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”2019å¹´1æœˆ21æ—¥æ›´æ­£â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”")]),t._v(" "),a("p",[t._v("æµè§ˆå™¨è®¿é—®Webé¡¹ç›®å¹¶ä¸ä¼šåˆ›å»ºSessionï¼Œåªæœ‰åœ¨ç¼–ç¨‹è°ƒç”¨request.getSession()æ–¹æ³•åSessionæ‰ä¼šå»ºç«‹ï¼Œæµè§ˆå™¨æ‰ä¼šæœ‰JSESSIONIDçš„Cookieã€‚")]),t._v(" "),a("p",[t._v("ä¸€èˆ¬æ˜¯è®¤è¯æˆåŠŸåï¼Œè°ƒç”¨getSession()ï¼ˆå…¶å®åœ¨è¿™ä¹‹å‰Sessionå¹¶ä¸å­˜åœ¨ï¼‰ï¼Œè·å¾—Sessionå¯¹è±¡ï¼Œç„¶åæŠŠä¿¡æ¯å­˜é‡Œé¢ã€‚")]),t._v(" "),a("p",[t._v("æ‰€ä»¥ï¼Œä¸€èˆ¬çš„ï¼Œåœ¨ç™»å½•ä¹‹å‰ï¼Œä½ ä¸ç®¡æ€ä¹ˆè®¿é—®ç½‘ç«™ï¼Œéƒ½ä¸ä¼šå»ºç«‹ä¼šè¯ã€‚")])])}),[],!1,null,null,null);s.default=e.exports}}]);