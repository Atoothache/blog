<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Java反射完全解析https: | 一颗牙疼</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="一颗牙疼的blog">
    
    <link rel="preload" href="/blog/assets/css/0.styles.dab10465.css" as="style"><link rel="preload" href="/blog/assets/js/app.21a2d829.js" as="script"><link rel="preload" href="/blog/assets/js/2.1110caee.js" as="script"><link rel="preload" href="/blog/assets/js/8.4a181c27.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.b37f75b3.js"><link rel="prefetch" href="/blog/assets/js/11.8a472738.js"><link rel="prefetch" href="/blog/assets/js/12.e5092513.js"><link rel="prefetch" href="/blog/assets/js/13.86fd9fc6.js"><link rel="prefetch" href="/blog/assets/js/14.5bab25b9.js"><link rel="prefetch" href="/blog/assets/js/15.4b5d86df.js"><link rel="prefetch" href="/blog/assets/js/16.d159be48.js"><link rel="prefetch" href="/blog/assets/js/17.bc6af114.js"><link rel="prefetch" href="/blog/assets/js/18.35896069.js"><link rel="prefetch" href="/blog/assets/js/19.8aafea61.js"><link rel="prefetch" href="/blog/assets/js/20.93547524.js"><link rel="prefetch" href="/blog/assets/js/21.669ece99.js"><link rel="prefetch" href="/blog/assets/js/22.0de8421f.js"><link rel="prefetch" href="/blog/assets/js/23.8e9ac3e5.js"><link rel="prefetch" href="/blog/assets/js/24.005d83b3.js"><link rel="prefetch" href="/blog/assets/js/25.af37709b.js"><link rel="prefetch" href="/blog/assets/js/26.d168b692.js"><link rel="prefetch" href="/blog/assets/js/27.2bdb76a9.js"><link rel="prefetch" href="/blog/assets/js/28.977d1796.js"><link rel="prefetch" href="/blog/assets/js/29.d8d56cdc.js"><link rel="prefetch" href="/blog/assets/js/3.eaf008a1.js"><link rel="prefetch" href="/blog/assets/js/30.bf64ad8d.js"><link rel="prefetch" href="/blog/assets/js/31.e30819aa.js"><link rel="prefetch" href="/blog/assets/js/32.3b621138.js"><link rel="prefetch" href="/blog/assets/js/33.fa63dd5c.js"><link rel="prefetch" href="/blog/assets/js/34.d38640b6.js"><link rel="prefetch" href="/blog/assets/js/35.b4ae9b6c.js"><link rel="prefetch" href="/blog/assets/js/36.39876732.js"><link rel="prefetch" href="/blog/assets/js/37.e422cfcf.js"><link rel="prefetch" href="/blog/assets/js/38.334206ab.js"><link rel="prefetch" href="/blog/assets/js/39.debc5e59.js"><link rel="prefetch" href="/blog/assets/js/4.e3a6601d.js"><link rel="prefetch" href="/blog/assets/js/40.888daae3.js"><link rel="prefetch" href="/blog/assets/js/41.1d03accf.js"><link rel="prefetch" href="/blog/assets/js/42.b90bb4bf.js"><link rel="prefetch" href="/blog/assets/js/43.b2d569fd.js"><link rel="prefetch" href="/blog/assets/js/44.d00c4d7c.js"><link rel="prefetch" href="/blog/assets/js/45.54826d8b.js"><link rel="prefetch" href="/blog/assets/js/46.53ef65d9.js"><link rel="prefetch" href="/blog/assets/js/47.30d13798.js"><link rel="prefetch" href="/blog/assets/js/48.13455c5d.js"><link rel="prefetch" href="/blog/assets/js/49.1c67bffe.js"><link rel="prefetch" href="/blog/assets/js/5.56007e33.js"><link rel="prefetch" href="/blog/assets/js/50.3c2a5f40.js"><link rel="prefetch" href="/blog/assets/js/51.876bfe91.js"><link rel="prefetch" href="/blog/assets/js/6.18dc24fc.js"><link rel="prefetch" href="/blog/assets/js/7.cc7a88d9.js"><link rel="prefetch" href="/blog/assets/js/9.b375d67c.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.dab10465.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">一颗牙疼</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="http://www.macrozheng.com/#/README" target="_blank" rel="noopener noreferrer" class="nav-link external">
  mall
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/Atoothache/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/" class="nav-link">
  Chinese
</a></li><li class="dropdown-item"><!----> <a href="/blog/" class="nav-link">
  Japanese
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="http://www.macrozheng.com/#/README" target="_blank" rel="noopener noreferrer" class="nav-link external">
  mall
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/Atoothache/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/" class="nav-link">
  Chinese
</a></li><li class="dropdown-item"><!----> <a href="/blog/" class="nav-link">
  Japanese
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Java</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/10-Java/java基础.html" class="sidebar-link">/10-Java/java基础.html</a></li><li><a href="/blog/10-Java/反射.html" class="active sidebar-link">Java反射完全解析https:</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/10-Java/异常处理.html" class="sidebar-link">Java异常处理</a></li><li><a href="/blog/10-Java/注解的本质.html" class="sidebar-link">java注解的本质与基本原理:</a></li><li><a href="/blog/10-Java/阻塞非阻塞式IO、同步异步IO.html" class="sidebar-link">Java IO：阻塞/非阻塞式IO、同步/异步IO</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>安全认证</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工具</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>脚本语言</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Spring</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>服务器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>框架</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据库</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>搜索引擎</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>设计模式</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="java反射完全解析https"><a href="#java反射完全解析https" class="header-anchor">#</a> Java反射完全解析https:</h1> <h1 id="www-jianshu-comp607ff4e79a13"><a href="#www-jianshu-comp607ff4e79a13" class="header-anchor">#</a> www.jianshu.comp607ff4e79a13</h1> <p>https://www.cnblogs.com/afei1013/p/12495847.html</p> <ul><li><p>RTTI，编译器在编译时打开和检查.class文件</p></li> <li><p>反射，运行时打开和检查.class文件</p> <h4 id="对以上的理解"><a href="#对以上的理解" class="header-anchor">#</a> <strong>对以上的理解：</strong></h4> <p>我们先明白几个概念：</p> <p><strong>动态加载</strong></p> <p>所有的类都是在对其第一次使用时，动态加载到 JVM，因此Java 程序在他开始运行之前并非被完全加载，其各个部分是在需要时才加载的。</p> <p><strong>Class 类概念</strong></p> <p>Class 也是一个 Java 类，保存的是与之对应 Java 类的 meta信息（元信息），用来描述这个类的结构，比如描述一个类有哪些成员，有哪些方法等，一般在反射中使用。</p> <p>**详细解释：**Java 源程序（.java 文件）在经过 Java 编译器编译之后就被转换成 Java 字节代码（.class 文件）。类加载器负责读取 Java 字节代码，并转换成 java.lang.Class类的一个实例（Class 对象）。也就是说，在 Java 中，每个 java 类都有一个相应的 Class 对象，用于表示这个 java 类的类型信息。</p> <p><strong>类加载概念</strong></p> <p>当使用一个类的时候（比如 new 一个类的实例），会检查此类是否被加载到内存，如果没有，则会执行加载操作。</p> <p>读取类对应的 class 文件数据，解析此数据，构造一个此类对应的 Class 类的实例。此时JVM就可以使用该类了，比如实例化此类，或者调用此类的静态方法。</p> <p>Java 也提供了手动加载类的接口，class.forName()方法就是其中之一。（说来说去，其实就是生成这个类的 Class）</p> <p><strong>类加载器的概念</strong></p> <p>顾名思义，类加载器（class loader）用来加载 Java 类到 Java 虚拟机中。一般来说，Java 虚拟机使用 Java 类的方式如下：Java 源程序（.java 文件）在经过 Java 编译器编译之后就被转换成 Java 字节代码（.class 文件）。类加载器负责读取 Java 字节代码，并转换成 java.lang.Class 类的一个实例。每个这样的实例用来表示一个 Java 类。通过此实例的 newInstance() 方法就可以创建出该类的一个对象。 基本上所有的类加载器都是 java.lang.ClassLoader 类的一个实例。</p> <p><strong>类初始化概念</strong></p> <p>类被加载之后，jvm 已经获得了一个描述类结构的 Class 实例。但是还需要进行类初始化操作之后才能正常使用此类，类初始化操作就是执行一遍类的静态语句，包括静态变量的声明还有静态代码块。</p> <p><strong>Class.forName() 方法</strong></p> <p>此方法含义是：加载参数指定的类，并且初始化它。</p> <p>刚才提到，<strong>Class.forName(&quot;&quot;);</strong> 的作用是要求 JVM 查找并加载指定的类，如果在类中有静态初始化器的话，JVM 必然会执行该类的静态代码 段。</p> <h4 id="现在我们可以对反射进行理解了"><a href="#现在我们可以对反射进行理解了" class="header-anchor">#</a> 现在我们可以对反射进行理解了</h4> <p>**例子：**在A类里面需要调用B类方法。</p> <p><strong>RTTI（也就是平时的New新建B类）：</strong></p> <p><em>编译期：</em>   在编译A类时会去检查是否有B类的.class文件存在，煤油的话就先编译B类生成.class文件，如果找不到B类或编译过程出错导致无法编译生成class文件那么A类就编译不通过。编译结束后A跟B已经绑定。</p> <p><em>运行期：</em>  在A运行到需要B时，jvm会自动先去检查B是否已被加载，如果B已经被加载生成Class对象，这直接调用Class对象生成B实例。如果B还没被加载，就会去加载B的.class文件生成Class对象。关键在于只能加载B的，Class对象都是固定是B的。也就是首次加载结束之后我们就无从去改变已经跟A绑定的Class对象。</p> <p><em>坏处：</em>  在编译完成后，也就是运行时B类的class文件是固定不可变的。这就是为什么说RTTI 是编译器在编译时打开和检查.class文件。</p> <p><strong>反射（利用反射调用B类）：</strong></p> <p>*编译期：*在编译A类时，不会检查是否有B的.class文件存在。无论B类的.class是否存在,A都只是查看一下他自己需要的B的class文件名称而已，都能编译通过。编译结束后A跟B未绑定。</p> <p>*运行期：*在A运行到需要B时，我们使用反射是利用class.forName（）手动控制jvm去动态加载。不一样的是反射通过class.forName（“B”）动态加载。引号内的的B只是一个字符串，所以我们上面说的编译期A就只是跟检查普通字符串一样检查B而已，A与B并无绑定。这时候如果引号内是一个变量，我们就可以动态改变A调用谁，而不仅仅是B，还可以是C，D。。。</p> <p><em>好处</em>：无论B的.class文件是否存在，只要A没有运行到需要B的地方，都可以正常运行，在运行到需要B之前，动态的加入B的class文件即可，也就是在运行过程中我们可以动态的改变B的.class文件。</p> <p>顺便补充：类加载后获得的Class对象就是用来生成该类的实例的。只是生成的这个过程RTTI是JVM自动做的，而反射是我们操控Class.newInstance去生成而已。</p></li></ul> <p>问题：反射时class.forName()只是获取.class文件的Class对象，那么这个class对象究竟在什么时候被创建？</p> <p>答：class.forName()的含义是加载参数指定的类，并且初始化它。既然是加载那么就会创建Class对象。</p> <p>参考菜鸟教程：https://www.runoob.com/w3cnote/java-class-forname.html</p> <h3 id="class对象简介"><a href="#class对象简介" class="header-anchor">#</a> Class对象简介</h3> <p>java 在运行时表示类型信息是通过class这个特殊对象来完成的，
class对象属于Class类，Class类用来表示一般类的信息，所以class对象包含了与类相关的信息，它主要有以下几个特点：</p> <ol><li>每个类都有一个与其相关的Class对象。</li> <li>Class对象含有与其相关类的类信息。</li> <li>Class对象用来创建与其相关类的“常规对象“</li> <li>Class对象保存在与其同名的.class文件中。</li></ol> <p>那么Class对象是如何产生的喃？</p> <p>Class对象是通过类加载器加载的，并且只有在第一次使用类时才会被加载。</p> <p>当使用一个类时，JVM的类加载器会先检查这个类的class对象是否已经被加载，如果没有被加载，则查找同名的.class文件。如果一旦发现类的class对象已经被加载到内存了，则使用这个class对象来创建这个类的所有对象。</p> <p>那么如何获取Class对象？</p> <ul><li><p>动态代理本质</p> <p>静态代理：比如用A需要创建一个C去代理B，那么我们这么做：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{</span> 
    <span class="token class-name">C</span> <span class="token function">proxy</span><span class="token punctuation">(</span><span class="token class-name">B</span> b<span class="token punctuation">)</span><span class="token punctuation">{</span>
    	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">C</span>（b）
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>也就说A只能创建B的代理类，如果我们想让A还能创建E，F，G...等的代理类咋办。</p> <p>动态代理：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{</span>
    <span class="token class-name">C</span> <span class="token function">proxy</span><span class="token punctuation">(</span><span class="token class-name">String</span> className<span class="token punctuation">)</span><span class="token punctuation">{</span>
    	<span class="token class-name">Object</span> o <span class="token operator">=</span> 反射（className<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//反射获取被代理类</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">C</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>通过类名反射出被代理类，再根据被代理类生成代理类。这时候你想代理什么类，只要把类名传进去生成的C就是你想要的代理类。（以上的new只是表示，通过被代理类生成代理类，并非实际代码的new）</p></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/10-Java/java基础.html" class="prev">
        /10-Java/java基础.html
      </a></span> <span class="next"><a href="/blog/10-Java/异常处理.html">
        Java异常处理
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.21a2d829.js" defer></script><script src="/blog/assets/js/2.1110caee.js" defer></script><script src="/blog/assets/js/8.4a181c27.js" defer></script>
  </body>
</html>
