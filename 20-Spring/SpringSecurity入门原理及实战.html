<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Spring Security å…¥é—¨åŸç†åŠå®æˆ˜ | ä¸€é¢—ç‰™ç–¼</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="ä¸€é¢—ç‰™ç–¼çš„blog">
    
    <link rel="preload" href="/blog/assets/css/0.styles.dab10465.css" as="style"><link rel="preload" href="/blog/assets/js/app.21a2d829.js" as="script"><link rel="preload" href="/blog/assets/js/2.1110caee.js" as="script"><link rel="preload" href="/blog/assets/js/23.8e9ac3e5.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.b37f75b3.js"><link rel="prefetch" href="/blog/assets/js/11.8a472738.js"><link rel="prefetch" href="/blog/assets/js/12.e5092513.js"><link rel="prefetch" href="/blog/assets/js/13.86fd9fc6.js"><link rel="prefetch" href="/blog/assets/js/14.5bab25b9.js"><link rel="prefetch" href="/blog/assets/js/15.4b5d86df.js"><link rel="prefetch" href="/blog/assets/js/16.d159be48.js"><link rel="prefetch" href="/blog/assets/js/17.bc6af114.js"><link rel="prefetch" href="/blog/assets/js/18.35896069.js"><link rel="prefetch" href="/blog/assets/js/19.8aafea61.js"><link rel="prefetch" href="/blog/assets/js/20.93547524.js"><link rel="prefetch" href="/blog/assets/js/21.669ece99.js"><link rel="prefetch" href="/blog/assets/js/22.0de8421f.js"><link rel="prefetch" href="/blog/assets/js/24.005d83b3.js"><link rel="prefetch" href="/blog/assets/js/25.af37709b.js"><link rel="prefetch" href="/blog/assets/js/26.d168b692.js"><link rel="prefetch" href="/blog/assets/js/27.2bdb76a9.js"><link rel="prefetch" href="/blog/assets/js/28.977d1796.js"><link rel="prefetch" href="/blog/assets/js/29.d8d56cdc.js"><link rel="prefetch" href="/blog/assets/js/3.eaf008a1.js"><link rel="prefetch" href="/blog/assets/js/30.bf64ad8d.js"><link rel="prefetch" href="/blog/assets/js/31.e30819aa.js"><link rel="prefetch" href="/blog/assets/js/32.3b621138.js"><link rel="prefetch" href="/blog/assets/js/33.fa63dd5c.js"><link rel="prefetch" href="/blog/assets/js/34.d38640b6.js"><link rel="prefetch" href="/blog/assets/js/35.b4ae9b6c.js"><link rel="prefetch" href="/blog/assets/js/36.39876732.js"><link rel="prefetch" href="/blog/assets/js/37.e422cfcf.js"><link rel="prefetch" href="/blog/assets/js/38.334206ab.js"><link rel="prefetch" href="/blog/assets/js/39.debc5e59.js"><link rel="prefetch" href="/blog/assets/js/4.e3a6601d.js"><link rel="prefetch" href="/blog/assets/js/40.888daae3.js"><link rel="prefetch" href="/blog/assets/js/41.1d03accf.js"><link rel="prefetch" href="/blog/assets/js/42.b90bb4bf.js"><link rel="prefetch" href="/blog/assets/js/43.b2d569fd.js"><link rel="prefetch" href="/blog/assets/js/44.d00c4d7c.js"><link rel="prefetch" href="/blog/assets/js/45.54826d8b.js"><link rel="prefetch" href="/blog/assets/js/46.53ef65d9.js"><link rel="prefetch" href="/blog/assets/js/47.30d13798.js"><link rel="prefetch" href="/blog/assets/js/48.13455c5d.js"><link rel="prefetch" href="/blog/assets/js/49.1c67bffe.js"><link rel="prefetch" href="/blog/assets/js/5.56007e33.js"><link rel="prefetch" href="/blog/assets/js/50.3c2a5f40.js"><link rel="prefetch" href="/blog/assets/js/51.876bfe91.js"><link rel="prefetch" href="/blog/assets/js/6.18dc24fc.js"><link rel="prefetch" href="/blog/assets/js/7.cc7a88d9.js"><link rel="prefetch" href="/blog/assets/js/8.4a181c27.js"><link rel="prefetch" href="/blog/assets/js/9.b375d67c.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.dab10465.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">ä¸€é¢—ç‰™ç–¼</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="http://www.macrozheng.com/#/README" target="_blank" rel="noopener noreferrer" class="nav-link external">
  mall
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/Atoothache/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/" class="nav-link">
  Chinese
</a></li><li class="dropdown-item"><!----> <a href="/blog/" class="nav-link">
  Japanese
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="http://www.macrozheng.com/#/README" target="_blank" rel="noopener noreferrer" class="nav-link external">
  mall
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/Atoothache/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/" class="nav-link">
  Chinese
</a></li><li class="dropdown-item"><!----> <a href="/blog/" class="nav-link">
  Japanese
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>å®‰å…¨è®¤è¯</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>å·¥å…·</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>è„šæœ¬è¯­è¨€</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Spring</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/20-Spring/SpringMVCæ‹¦æˆªå™¨åŸç†.html" class="sidebar-link">SpringMVC æ‹¦æˆªå™¨åŸç†</a></li><li><a href="/blog/20-Spring/SpringSecurityå…¥é—¨åŸç†åŠå®æˆ˜.html" class="active sidebar-link">Spring Security å…¥é—¨åŸç†åŠå®æˆ˜</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/20-Spring/SpringSecurityå…¥é—¨åŸç†åŠå®æˆ˜.html#securitycontextæ¥å£" class="sidebar-link">SecurityContextæ¥å£</a></li><li class="sidebar-sub-header"><a href="/blog/20-Spring/SpringSecurityå…¥é—¨åŸç†åŠå®æˆ˜.html#authenticationæ¥å£åˆæ˜¯å¹²å˜›çš„" class="sidebar-link">Authenticationæ¥å£åˆæ˜¯å¹²å˜›çš„ï¼Ÿ</a></li><li class="sidebar-sub-header"><a href="/blog/20-Spring/SpringSecurityå…¥é—¨åŸç†åŠå®æˆ˜.html#securitycontextholderå·¥å…·ç±»" class="sidebar-link">SecurityContextHolderå·¥å…·ç±»</a></li><li class="sidebar-sub-header"><a href="/blog/20-Spring/SpringSecurityå…¥é—¨åŸç†åŠå®æˆ˜.html#è¯·æ±‚ç»“æŸ-securitycontextå­˜å‚¨åœ¨å“ªé‡Œ" class="sidebar-link">è¯·æ±‚ç»“æŸï¼ŒSecurityContextå­˜å‚¨åœ¨å“ªé‡Œï¼Ÿ</a></li><li class="sidebar-sub-header"><a href="/blog/20-Spring/SpringSecurityå…¥é—¨åŸç†åŠå®æˆ˜.html#æµç¨‹è§†å›¾" class="sidebar-link">æµç¨‹è§†å›¾</a></li><li class="sidebar-sub-header"><a href="/blog/20-Spring/SpringSecurityå…¥é—¨åŸç†åŠå®æˆ˜.html#securitycontextpersistencefilteræ‹¦æˆªå™¨" class="sidebar-link">SecurityContextPersistenceFilteræ‹¦æˆªå™¨</a></li></ul></li><li><a href="/blog/20-Spring/é™æ€å˜é‡æ³¨å…¥bean.html" class="sidebar-link">é™æ€å˜é‡æ³¨å…¥beanï¼Œ@Autowireçš„æ³¨å…¥æ—¶æœŸ</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>æœåŠ¡å™¨</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>æ¡†æ¶</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>æ•°æ®åº“</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>æœç´¢å¼•æ“</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>è®¾è®¡æ¨¡å¼</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>å‰ç«¯</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="spring-security-å…¥é—¨åŸç†åŠå®æˆ˜"><a href="#spring-security-å…¥é—¨åŸç†åŠå®æˆ˜" class="header-anchor">#</a> Spring Security å…¥é—¨åŸç†åŠå®æˆ˜</h1> <p>https://www.cnblogs.com/demingblog/p/10874753.html</p> <h1 id="ã€è¯¦è§£ã€‘spring-security-ä¹‹-securitycontext"><a href="#ã€è¯¦è§£ã€‘spring-security-ä¹‹-securitycontext" class="header-anchor">#</a> ã€è¯¦è§£ã€‘Spring Security ä¹‹ SecurityContext</h1> <p>https://www.cnblogs.com/longfurcat/p/10293819.html</p> <p>æ•´ç†ä¸€ä¸‹SecurityContextçš„å­˜å‚¨æ–¹å¼ã€‚</p> <h2 id="securitycontextæ¥å£"><a href="#securitycontextæ¥å£" class="header-anchor">#</a> SecurityContextæ¥å£</h2> <p>é¡¾åæ€ä¹‰ï¼Œå®‰å…¨ä¸Šä¸‹æ–‡ã€‚å³å­˜å‚¨è®¤è¯æˆæƒçš„ç›¸å…³ä¿¡æ¯ï¼Œå®é™…ä¸Šå°±æ˜¯å­˜å‚¨&quot;<strong>å½“å‰ç”¨æˆ·</strong>&quot;è´¦å·ä¿¡æ¯å’Œç›¸å…³æƒé™ã€‚è¿™ä¸ªæ¥å£åªæœ‰ä¸¤ä¸ªæ–¹æ³•ï¼ŒAuthenticationå¯¹è±¡çš„getterã€setterã€‚</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>context</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Serializable</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">Authentication</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SecurityContext</span> <span class="token keyword">extends</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
    <span class="token class-name">Authentication</span> <span class="token function">getAuthentication</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">setAuthentication</span><span class="token punctuation">(</span><span class="token class-name">Authentication</span> var1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="authenticationæ¥å£åˆæ˜¯å¹²å˜›çš„"><a href="#authenticationæ¥å£åˆæ˜¯å¹²å˜›çš„" class="header-anchor">#</a> Authenticationæ¥å£åˆæ˜¯å¹²å˜›çš„ï¼Ÿ</h2> <p>æ³¨æ„ï¼šSecurityContextå­˜å‚¨çš„Authenticationå¯¹è±¡æ˜¯ç»è¿‡è®¤è¯çš„ï¼Œæ‰€ä»¥å®ƒä¼šå¸¦æœ‰æƒé™ï¼Œå®ƒçš„getAuthorities()æ–¹æ³•ä¼šè¿”å›ç›¸å…³æƒé™ã€‚</p> <p>[<img src="https://common.cnblogs.com/images/copycode.gif" alt="å¤åˆ¶ä»£ç ">](javascript:void(0)ğŸ˜‰</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Serializable</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">Principal</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Collection</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Authentication</span> <span class="token keyword">extends</span> <span class="token class-name">Principal</span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
    <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">GrantedAuthority</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAuthorities</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Object</span> <span class="token function">getCredentials</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Object</span> <span class="token function">getDetails</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Object</span> <span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">boolean</span> <span class="token function">isAuthenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">setAuthenticated</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> var1<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>[<img src="https://common.cnblogs.com/images/copycode.gif" alt="å¤åˆ¶ä»£ç ">](javascript:void(0)ğŸ˜‰</p> <h2 id="securitycontextholderå·¥å…·ç±»"><a href="#securitycontextholderå·¥å…·ç±»" class="header-anchor">#</a> SecurityContextHolderå·¥å…·ç±»</h2> <p>å‰é¢è¯´çš„&quot;<strong>å½“å‰ç”¨æˆ·</strong>&quot;å®é™…ä¸ŠæŒ‡çš„æ˜¯å½“å‰è¿™ä¸ªè¯·æ±‚æ‰€å¯¹åº”çš„ç”¨æˆ·ï¼Œé‚£ä¹ˆæ€ä¹ˆçŸ¥é“å½“å‰ç”¨æˆ·æ˜¯è°å‘¢ï¼Ÿç”±äºä¸€ä¸ªè¯·æ±‚ä»å¼€å§‹åˆ°ç»“æŸéƒ½ç”±ä¸€ä¸ªçº¿ç¨‹å¤„ç†ï¼Œè¿™ä¸ªçº¿ç¨‹ä¸­é€”ä¹Ÿä¸ä¼šå»å¤„ç†å…¶ä»–çš„è¯·æ±‚ã€‚æ‰€ä»¥åœ¨è¿™æ®µæ—¶é—´å†…ï¼Œç›¸å½“äºè¿™ä¸ªçº¿ç¨‹è·Ÿå½“å‰ç”¨æˆ·æ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚SecurityContextHolderå·¥å…·ç±»å°±æ˜¯æŠŠSecurityContextå­˜å‚¨åœ¨å½“å‰çº¿ç¨‹ä¸­ã€‚</p> <p>SecurityContextHolderå¯ä»¥ç”¨æ¥è®¾ç½®å’Œè·å–SecurityContextã€‚å®ƒä¸»è¦æ˜¯ç»™æ¡†æ¶å†…éƒ¨ä½¿ç”¨çš„ï¼Œå¯ä»¥åˆ©ç”¨å®ƒè·å–å½“å‰ç”¨æˆ·çš„SecurityContextè¿›è¡Œè¯·æ±‚æ£€æŸ¥ï¼Œå’Œè®¿é—®æ§åˆ¶ç­‰ã€‚</p> <p>åœ¨Webç¯å¢ƒä¸‹ï¼ŒSecurityContextHolderæ˜¯åˆ©ç”¨ThreadLocalæ¥å­˜å‚¨SecurityContextçš„ã€‚</p> <h2 id="è¯·æ±‚ç»“æŸ-securitycontextå­˜å‚¨åœ¨å“ªé‡Œ"><a href="#è¯·æ±‚ç»“æŸ-securitycontextå­˜å‚¨åœ¨å“ªé‡Œ" class="header-anchor">#</a> <strong>è¯·æ±‚ç»“æŸï¼ŒSecurityContextå­˜å‚¨åœ¨å“ªé‡Œï¼Ÿ</strong></h2> <p>æˆ‘ä»¬çŸ¥é“Sevletä¸­çº¿ç¨‹æ˜¯è¢«æ± åŒ–å¤ç”¨çš„ï¼Œä¸€æ—¦å¤„ç†å®Œå½“å‰çš„è¯·æ±‚ï¼Œå®ƒå¯èƒ½é©¬ä¸Šå°±ä¼šè¢«åˆ†é…å»å¤„ç†å…¶ä»–çš„è¯·æ±‚ã€‚è€Œä¸”ä¹Ÿä¸èƒ½ä¿è¯ç”¨æˆ·ä¸‹æ¬¡çš„è¯·æ±‚ä¼šè¢«åˆ†é…åˆ°åŒä¸€ä¸ªçº¿ç¨‹ã€‚æ‰€ä»¥å­˜åœ¨çº¿ç¨‹é‡Œé¢ï¼Œè¯·æ±‚ä¸€æ—¦ç»“æŸï¼Œå°±æ²¡äº†ã€‚å¦‚æœæ²¡æœ‰ä¿å­˜ï¼Œä¸æ˜¯æ¯æ¬¡è¯·æ±‚éƒ½è¦é‡æ–°è®¤è¯ç™»å½•ï¼Ÿæƒ³æƒ³çœ‹ï¼Œå¦‚æœæ²¡æœ‰æƒé™æ¡†æ¶æˆ‘ä»¬æ˜¯æ€ä¹ˆå¤„ç†çš„ï¼Ÿ</p> <p>æƒ³åˆ°äº†å§ï¼Œå¦‚æœä¸ç”¨æƒé™æ¡†æ¶ï¼Œæˆ‘ä»¬ä¸€èˆ¬æ˜¯æŠŠè®¤è¯ç»“æœå­˜åœ¨Sessionä¸­çš„ã€‚åŒç†ï¼Œå®ƒä¹ŸæŠŠè®¤è¯ç»“æœå­˜å‚¨åˆ°Sessionäº†ã€‚</p> <p>å¯¹åº”çš„Keyæ˜¯ï¼š&quot;<strong>SPRING_SECURITY_CONTEXT</strong>&quot;</p> <h2 id="æµç¨‹è§†å›¾"><a href="#æµç¨‹è§†å›¾" class="header-anchor">#</a> æµç¨‹è§†å›¾</h2> <p><img src="E:%5Cgitbook%5CSpring%5Cpic%5CSecurityContext%E7%9A%84%E5%AD%98%E5%82%A8%E6%B5%81%E7%A8%8B.png" alt=""></p> <h2 id="securitycontextpersistencefilteræ‹¦æˆªå™¨"><a href="#securitycontextpersistencefilteræ‹¦æˆªå™¨" class="header-anchor">#</a> SecurityContextPersistenceFilteræ‹¦æˆªå™¨</h2> <p>SecurityContextPersistenceFilteræ˜¯Securityçš„æ‹¦æˆªå™¨ï¼Œè€Œä¸”æ˜¯æ‹¦æˆªé“¾ä¸­çš„ç¬¬ä¸€ä¸ªæ‹¦æˆªå™¨ï¼Œè¯·æ±‚æ¥ä¸´æ—¶å®ƒä¼šä»HttpSessionä¸­æŠŠSecurityContextå–å‡ºæ¥ï¼Œç„¶åæ”¾å…¥SecurityContextHolderã€‚åœ¨æ‰€æœ‰æ‹¦æˆªå™¨éƒ½å¤„ç†å®Œæˆåï¼Œå†æŠŠSecurityContextå­˜å…¥HttpSessionï¼Œå¹¶æ¸…é™¤SecurityContextHolderå†…çš„å¼•ç”¨ã€‚</p> <p>æ³¨ï¼šå…¶ä¸­repoå¯¹è±¡æ˜¯HttpSessionSecurityContextRepository</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> res<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> chain<span class="token punctuation">)</span>
            <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>
        <span class="token class-name">HttpServletRequest</span> request <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">)</span> req<span class="token punctuation">;</span>
        <span class="token class-name">HttpServletResponse</span> response <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span><span class="token punctuation">)</span> res<span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span>FILTER_APPLIED<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// ensure that filter is only applied once per request</span>
            chain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">final</span> <span class="token keyword">boolean</span> debug <span class="token operator">=</span> logger<span class="token punctuation">.</span><span class="token function">isDebugEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        request<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>FILTER_APPLIED<span class="token punctuation">,</span> <span class="token class-name">Boolean</span><span class="token punctuation">.</span>TRUE<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>forceEagerSessionCreation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">HttpSession</span> session <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>debug <span class="token operator">&amp;&amp;</span> session<span class="token punctuation">.</span><span class="token function">isNew</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Eagerly created session: &quot;</span> <span class="token operator">+</span> session<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">HttpRequestResponseHolder</span> holder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpRequestResponseHolder</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span>
                response<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//åˆ©ç”¨HttpSecurityContextRepositoryä»HttpSesionä¸­è·å–SecurityContextå¯¹è±¡</span>
        <span class="token comment">//å¦‚æœæ²¡æœ‰HttpSessionï¼Œå³æµè§ˆå™¨ç¬¬ä¸€æ¬¡è®¿é—®æœåŠ¡å™¨ï¼Œè¿˜æ²¡æœ‰äº§ç”Ÿä¼šè¯ã€‚</span>
        <span class="token comment">//å®ƒä¼šåˆ›å»ºä¸€ä¸ªç©ºçš„SecurityContextå¯¹è±¡</span>
        <span class="token class-name">SecurityContext</span> contextBeforeChainExecution <span class="token operator">=</span> repo<span class="token punctuation">.</span><span class="token function">loadContext</span><span class="token punctuation">(</span>holder<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">//æŠŠSecurityContextæ”¾å…¥åˆ°SecurityContextHolderä¸­</span>
            <span class="token class-name">SecurityContextHolder</span><span class="token punctuation">.</span><span class="token function">setContext</span><span class="token punctuation">(</span>contextBeforeChainExecution<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//æ‰§è¡Œæ‹¦æˆªé“¾ï¼Œè¿™ä¸ªé“¾ä¼šé€å±‚å‘ä¸‹æ‰§è¡Œ</span>
            chain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>holder<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> holder<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>
        <span class="token keyword">finally</span> <span class="token punctuation">{</span> 
            <span class="token comment">//å½“æ‹¦æˆªå™¨éƒ½æ‰§è¡Œå®Œçš„æ—¶å€™æŠŠå½“å‰çº¿ç¨‹å¯¹åº”çš„SecurityContextä»SecurityContextHolderä¸­å–å‡ºæ¥</span>
            <span class="token class-name">SecurityContext</span> contextAfterChainExecution <span class="token operator">=</span> <span class="token class-name">SecurityContextHolder</span>
                    <span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// Crucial removal of SecurityContextHolder contents - do this before anything</span>
            <span class="token comment">// else.</span>
            <span class="token class-name">SecurityContextHolder</span><span class="token punctuation">.</span><span class="token function">clearContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//åˆ©ç”¨HttpSecurityContextRepositoryæŠŠSecurityContextå†™å…¥HttpSession</span>
            repo<span class="token punctuation">.</span><span class="token function">saveContext</span><span class="token punctuation">(</span>contextAfterChainExecution<span class="token punctuation">,</span> holder<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    holder<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            request<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span>FILTER_APPLIED<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>debug<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;SecurityContextHolder now cleared, as request processing completed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><h3 id="tomcatå»ºç«‹ä¼šè¯çš„æµç¨‹"><a href="#tomcatå»ºç«‹ä¼šè¯çš„æµç¨‹" class="header-anchor">#</a> Tomcatå»ºç«‹ä¼šè¯çš„æµç¨‹</h3> <p>æœ‰äººå¯èƒ½å¯¹Tomcatå»ºç«‹ä¼šè¯çš„æµç¨‹è¿˜ä¸ç†Ÿæ‚‰ï¼Œè¿™é‡Œç¨å¾®æ•´ç†ä¸€ä¸‹ã€‚æ˜¯è¿™æ ·çš„ï¼Œå½“å®¢æˆ·æµè§ˆå™¨æ‰“å¼€åç¬¬ä¸€æ¬¡è®¿é—®TomcatæœåŠ¡å™¨ï¼ŒTomcatä¼šåˆ›å»ºä¸€ä¸ªHttpSesionå¯¹è±¡ï¼Œå­˜å…¥ä¸€ä¸ªConcurrentHashMapï¼ŒKeyæ˜¯SessionIdï¼ŒValueå°±æ˜¯HttpSessionã€‚ç„¶åè¯·æ±‚å®Œæˆåï¼Œåœ¨è¿”å›çš„æŠ¥æ–‡ä¸­æ·»åŠ <strong>Set-Cookieï¼šJSESSIONID=xxx</strong>ï¼Œç„¶åå®¢æˆ·ç«¯æµè§ˆå™¨ä¼šä¿å­˜è¿™ä¸ªCookieã€‚å½“æµè§ˆå™¨å†æ¬¡è®¿é—®è¿™ä¸ªæœåŠ¡å™¨çš„æ—¶å€™ï¼Œéƒ½ä¼šå¸¦ä¸Šè¿™ä¸ªCookieã€‚Tomcatæ¥æ”¶åˆ°è¿™ä¸ªè¯·æ±‚åï¼Œæ ¹æ®JSESSIONIDæŠŠå¯¹åº”çš„HttpSessionå¯¹è±¡å–å‡ºæ¥ï¼Œæ”¾å…¥HttpSerlvetRequestå¯¹è±¡é‡Œé¢ã€‚</p> <p><strong>é‡ç‚¹ï¼š</strong></p> <p>1.HttpSessionä¼šä¸€ç›´å­˜åœ¨æœåŠ¡ç«¯ï¼Œå®é™…ä¸Šæ˜¯å­˜åœ¨è¿è¡Œå†…å­˜ä¸­ã€‚é™¤éSessionè¿‡æœŸ OR Tomcatå¥”æºƒ OR æœåŠ¡å™¨å¥”æºƒï¼Œå¦åˆ™ä¼šè¯ä¿¡æ¯ä¸ä¼šæ¶ˆå¤±ã€‚</p> <p>2.å¦‚æ— ç‰¹æ®Šå¤„ç†ï¼ŒCookie JSESSIONIDä¼šåœ¨æµè§ˆå™¨å…³é—­çš„æ—¶å€™æ¸…é™¤ã€‚</p> <p>3.Tomcatä¸­HttpSesionçš„é»˜è®¤è¿‡æœŸæ—¶é—´ä¸º30åˆ†é’Ÿã€‚</p> <p>4.è¿™äº›å¤„ç†éƒ½åœ¨Securityçš„æ‹¦æˆªé“¾ä¹‹å‰å®Œæˆã€‚</p> <p>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”2019å¹´1æœˆ21æ—¥æ›´æ­£â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</p> <p>æµè§ˆå™¨è®¿é—®Webé¡¹ç›®å¹¶ä¸ä¼šåˆ›å»ºSessionï¼Œåªæœ‰åœ¨ç¼–ç¨‹è°ƒç”¨request.getSession()æ–¹æ³•åSessionæ‰ä¼šå»ºç«‹ï¼Œæµè§ˆå™¨æ‰ä¼šæœ‰JSESSIONIDçš„Cookieã€‚</p> <p>ä¸€èˆ¬æ˜¯è®¤è¯æˆåŠŸåï¼Œè°ƒç”¨getSession()ï¼ˆå…¶å®åœ¨è¿™ä¹‹å‰Sessionå¹¶ä¸å­˜åœ¨ï¼‰ï¼Œè·å¾—Sessionå¯¹è±¡ï¼Œç„¶åæŠŠä¿¡æ¯å­˜é‡Œé¢ã€‚</p> <p>æ‰€ä»¥ï¼Œä¸€èˆ¬çš„ï¼Œåœ¨ç™»å½•ä¹‹å‰ï¼Œä½ ä¸ç®¡æ€ä¹ˆè®¿é—®ç½‘ç«™ï¼Œéƒ½ä¸ä¼šå»ºç«‹ä¼šè¯ã€‚</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/blog/20-Spring/SpringMVCæ‹¦æˆªå™¨åŸç†.html" class="prev">
        SpringMVC æ‹¦æˆªå™¨åŸç†
      </a></span> <span class="next"><a href="/blog/20-Spring/é™æ€å˜é‡æ³¨å…¥bean.html">
        é™æ€å˜é‡æ³¨å…¥beanï¼Œ@Autowireçš„æ³¨å…¥æ—¶æœŸ
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.21a2d829.js" defer></script><script src="/blog/assets/js/2.1110caee.js" defer></script><script src="/blog/assets/js/23.8e9ac3e5.js" defer></script>
  </body>
</html>
